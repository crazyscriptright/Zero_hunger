<div class="container mx-auto p-6">
    <h2 class="text-2xl font-bold mb-4">Add Spending Record</h2>
    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 bg-white p-6 rounded-lg shadow-md mt-10 w-full">
        <!-- Spending Form Section -->
        <div class="flex flex-col justify-center">
            <p class="text-lg text-center font-semibold text-gray-700 mb-4">
                Total Available Balance: <span id="available_balance" class="text-green-600">Loading...</span>
            </p>
            
            <form id="spending-form" class="space-y-4">
                <!-- Spending Amount Input -->
                <div>
                    <label for="spending_amount" class="block text-sm font-medium text-gray-700">Spending Amount</label>
                    <div class="flex items-center border rounded-lg px-3 py-2 shadow-sm hover:shadow-md transition duration-300">
                        <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.104 0-2 .896-2 2v4c0 1.104.896 2 2 2s2-.896 2-2v-4c0-1.104-.896-2-2-2z"></path>
                        </svg>
                        <input type="number" id="spending_amount" class="ml-2 block w-full border-none focus:ring-0 no-spinner" required step="any">
                    </div>
                </div>

                <!-- Purpose Input -->
                <div>
                    <label for="purpose" class="block text-sm font-medium text-gray-700">Purpose</label>
                    <div class="flex items-center border rounded-lg px-3 py-2 shadow-sm hover:shadow-md transition duration-300">
                        <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h11m0 0l4-4m-4 4l4 4"></path>
                        </svg>
                        <input type="text" id="purpose" class="ml-2 block w-full border-none focus:ring-0" required oninput="this.value = this.value.replace(/[^a-zA-Z\s]/g, '')">
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded-lg flex justify-center items-center hover:bg-blue-600 transition duration-300">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Submit
                </button>
            </form>

            <!-- Message Display -->
            <p id="message" class="text-center text-red-500 mt-4"></p>
        </div>

        <!-- Image Section -->
        <div class="hidden md:flex justify-center items-center">
            <img src="/static/spent.webp" alt="Spending" class="w-64 h-auto rounded-lg shadow-lg hover:shadow-xl transition duration-300">
        </div>
    </div>
</div>
<style>
    /* Hide number input arrows in Chrome, Safari, Edge, and Opera */
    input.no-spinner::-webkit-outer-spin-button,
    input.no-spinner::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
  
    /* Hide number input arrows in Firefox */
    input.no-spinner {
      -moz-appearance: textfield;
    }
</style>
  
<script>
    // Function to fetch and calculate the available balance
    // Function to fetch and display the available balance
    async function fetchAvailableBalance() {
        try {
            const response = await fetch("/available_balance");
            const data = await response.json();
            document.getElementById("available_balance").textContent = data.available_balance;
        } catch (error) {
            console.error("Error fetching available balance:", error);
            document.getElementById("available_balance").textContent = "Error loading balance";
        }
    }

    // Fetch and display the available balance when the page loads
    document.addEventListener("DOMContentLoaded", fetchAvailableBalance);

   // Handle form submission
    document.getElementById("spending-form").addEventListener("submit", async function(event) {
        event.preventDefault();
        const spendingAmount = document.getElementById("spending_amount").value;
        const purpose = document.getElementById("purpose").value;
        
        const response = await fetch("{{ url_for('add_spending') }}", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ spending_amount: parseInt(spendingAmount), purpose })
        });
        
        const result = await response.json();
        const messageElem = document.getElementById("message");
        
        if (response.ok) {
            messageElem.textContent = "Success: " + result.message;
            messageElem.classList.remove("text-red-500");
            messageElem.classList.add("text-green-500");

            // Re-fetch and update the available balance after adding a new spending record
            await fetchAvailableBalance();
        } else {
            messageElem.textContent = "Error: " + result.detail;
            messageElem.classList.remove("text-green-500");
            messageElem.classList.add("text-red-500");
        }
    });
</script>